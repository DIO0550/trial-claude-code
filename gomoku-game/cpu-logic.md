# CPU Logic Specification (CPUロジック仕様書)

## 概要

五目並べゲームにおける5段階のCPU難易度別の戦略仕様を定義します。各難易度は異なるアルゴリズムと思考レベルを持ち、プレイヤーに段階的な挑戦を提供します。

## 難易度レベル構成

| 難易度 | レベル名 | 説明 | 実装状況 |
|--------|----------|------|----------|
| beginner | 入門 | ほぼランダム配置 | ✅ 実装済み |
| easy | やさしい | 基本的な防御重視 | ✅ 実装済み |
| medium | ふつう | 攻撃と防御のバランス | ❌ 未実装 |
| hard | むずかしい | 攻撃重視・3手先読み | ❌ 未実装 |
| expert | エキスパート | 最高レベル・5手先読み | ❌ 未実装 |

## 各難易度の詳細仕様

### 1. Beginner（入門）

**戦略コンセプト**: 完全ランダム
- **思考時間**: なし
- **探索深度**: 0手先
- **戦略**: 利用可能な位置からランダムに選択
- **特徴**: 初心者が勝ちやすい、ゲームルール学習向け

**実装アルゴリズム**:
```
1. 空いている位置をすべて取得
2. ランダムに1つ選択して配置
```

### 2. Easy（やさしい）

**戦略コンセプト**: 基本防御 + 序盤中央配置
- **思考時間**: 短い（瞬時）
- **探索深度**: 1手先（即座の脅威のみ）
- **戦略優先順位**:
  1. 自分の勝利（4連続→5連続）
  2. 相手の阻止（相手4連続を防ぐ）
  3. 序盤中央配置（4手目まで）
  4. ランダム配置

**実装アルゴリズム**:
```
1. 勝利判定: 自分が4連続なら5連続にする手を打つ
2. 防御判定: 相手が4連続なら阻止する手を打つ
3. 序盤戦略: 手数4未満なら中央エリア（7±3）から選択
4. その他: ランダム配置
```

### 3. Medium（ふつう）【未実装】

**戦略コンセプト**: バランス型 + パターン認識
- **思考時間**: 中程度（0.5秒程度）
- **探索深度**: 2手先読み
- **戦略要素**:
  - 3連続の形成・阻止
  - 2連続の延長
  - フォーク（分岐攻撃）の基本形
  - 序盤の定石配置

**実装予定アルゴリズム**:
```
1. 即座勝利・防御（Easy同様）
2. 3連続脅威の処理（作る・阻止）
3. フォーク狙い（複数の3連続候補）
4. 2連続の延長
5. 序盤定石（星・連星配置）
6. 評価関数による最適手選択
```

**評価項目**:
- 連続数による得点（2連:10点、3連:100点、4連:1000点）
- 空きスペースの多さ
- 中央からの距離

### 4. Hard（むずかしい）【未実装】

**戦略コンセプト**: 攻撃重視 + 3手先読み
- **思考時間**: 長め（1-2秒）
- **探索深度**: 3手先読み
- **戦略要素**:
  - 複雑なフォーク攻撃
  - 必勝パターンの認識
  - 相手の戦略予測
  - 高度な序盤定石

**実装予定アルゴリズム**:
```
1. ミニマックス法（3手先）
2. アルファベータ枝刈り
3. 複合脅威の評価
4. 必勝パターン辞書
5. 序盤定石データベース
```

**評価関数**:
- 攻撃的評価（自分の連続を重視）
- 位置価値（戦略的要所）
- パターンマッチング（定跡・必勝形）

### 5. Expert（エキスパート）【未実装】

**戦略コンセプト**: 最高難易度 + 5手先読み
- **思考時間**: 最長（3-5秒）
- **探索深度**: 5手先読み
- **戦略要素**:
  - 完全戦略計算
  - 終盤完全読み
  - 高度な序盤理論
  - 人間レベルの戦略

**実装予定アルゴリズム**:
```
1. 高度なミニマックス（5手先）
2. 置換表による高速化
3. 反復深化探索
4. 終盤完全解析（残り手数少ない時）
5. オープニングブック（序盤定石集）
6. パターン認識エンジン
```

**高度な機能**:
- 勝率計算
- 最善手確率表示
- 複数候補手の評価値表示

## 共通実装要素

### 基本判定機能
- **勝利判定**: 5連続検出（4方向）
- **脅威判定**: N連続検出（N=2,3,4）
- **配置可能判定**: 空位置確認

### ユーティリティ関数
- **方向ベクトル**: `[(1,0), (0,1), (1,1), (1,-1)]`
- **連続カウント**: 指定方向の連続石数計算
- **空きスペース**: 連続可能な空位置検出

### パフォーマンス考慮
- **位置キャッシュ**: 評価済み位置の記録
- **計算時間制限**: 各難易度の思考時間上限
- **メモリ最適化**: 不要なデータの解放

## 実装優先順位

1. **Medium**: バランス型戦略とパターン認識
2. **Hard**: 3手先読みとフォーク攻撃
3. **Expert**: 5手先読みと完全戦略

各段階で十分なテストとバランス調整を行い、プレイヤーが段階的にスキルアップできるような難易度曲線を実現します。

## テスト要件

各難易度について以下のテストを実装:
- **戦略テスト**: 特定局面での期待手の確認
- **性能テスト**: 思考時間の制限内での動作確認
- **回帰テスト**: アップデート時の動作保証
- **バランステスト**: 人間プレイヤーとの勝率測定